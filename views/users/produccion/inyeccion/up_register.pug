<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Polimetal SA - Inyeccion</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/dashboard/">
    <link href="//cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link href="/assets/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/stylesheets/dashboard.css" rel="stylesheet">
    style. 
        ul {
        list-style-type: none;
        }

        ul ul {
        display: none;
        }

        li.año, li.mes {
        cursor: pointer;
        }

        li.año:hover, li.mes:hover {
        text-decoration: underline;
        }

        li.año.active > ul,
        li.mes.active > ul {
        display: block;
        }
        li.fecha, li.turno {
        cursor: pointer;
        }

        li.fecha:hover, li.turno:hover {
        text-decoration: underline;
        }

        li.fecha.active > ul,
        li.turno.active > ul {
        display: block;
        }
  </head>
  <body>
    
    <header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
      <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="#">POLIMETAL S.A</a>
      <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      h3(class="navbar-brand navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow w-100")= "Bienvenido "+nombre
      <div class="navbar-nav">
        <div class="nav-item text-nowrap">
          <a class="nav-link px-3" href="#">Sign out</a>
        </div>
      </div>
    </header>

    <div class="container-fluid">
      <div class="row">
        <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
          <div class="position-sticky pt-3">
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="#">
                  <span data-feather="home"></span>
                    | Inicio
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" href="#">
                  <span data-feather="file"></span>
                   |Registros de Produccion
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="bar-chart-2"></span>
                   |Registro de paradas
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="users"></span>
                   |Customers
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="bar-chart-2"></span>
                   |Reports
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="layers"></span>
                   |Integrations
                </a>
              </li>
            </ul>

            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
              <span>Saved reports</span>
              <a class="link-secondary" href="#" aria-label="Add a new report">
                <span data-feather="plus-circle"></span>
              </a>
            </h6>
            <ul class="nav flex-column mb-2">
              <li class="nav-item">
                <a class="nav-link" href="produccion/">
                  <span data-feather="file-text"></span>
                   |Moldes entre fechas
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="produccion/inyeccion/modelos">
                  <span data-feather="file-text"></span>
                   |Modelos entre fechas
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="produccion/inyeccion/tornillos">
                  <span data-feather="file-text"></span>
                   |Tornillos
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="file-text"></span>
                   |Year-end sale
                </a>
              </li>
            </ul>
          </div>
        </nav>

        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
          <div class="d-flex bg-light justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            ul#arbolDatos
                li Año 1 
                li Año 2 

         
        </main>
      </div>
    </div>
   
    <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js" ></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.2.0/chartjs-plugin-datalabels.min.js" integrity="sha512-JPcRR8yFa8mmCsfrw4TNte1ZvF1e3+1SdGMslZvmrzDYxS69J7J49vkFL8u6u8PlPJK+H3voElBtUCzaXj+6ig==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="/javascripts/dashboard.js"></script>
    <script src="/assets/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    
    script.
      feather.replace({ 'aria-hidden': 'true' })
      document.addEventListener("DOMContentLoaded", () => {
        fetch('datosUp')
            .then(response => response.json())
            .then(data => {
            // Agrupar los datos por año y mes
            const agrupados = agruparPorAñoMesFechaTurno(data);
            // Renderizar el árbol de datos
            renderizarArbol(agrupados);
            });
        });

        // Función para agrupar los datos por año y mes
        function agruparPorAñoMesFechaTurno(data) {
            const agrupados = {};
            data.forEach(registro => {
                const { año, mes, fecha, turno, molde_1, id } = registro;
                
                if (!agrupados[año]) agrupados[año] = {};
                if (!agrupados[año][mes]) agrupados[año][mes] = {};
                if (!agrupados[año][mes][fecha]) agrupados[año][mes][fecha] = [];
                
                agrupados[año][mes][fecha].push({ turno, molde_1, id });
            });
            return agrupados;
        }

       // Función para renderizar el árbol de datos
        function renderizarArbol(agrupados) {
        const arbol = document.getElementById('arbolDatos');
        arbol.innerHTML = '';  // Limpiar cualquier contenido previo

        Object.keys(agrupados).forEach(año => {
            const liAño = document.createElement('li');
            const ulMeses = document.createElement('ul');
            liAño.textContent = año;
            liAño.classList.add('año');
            
            Object.keys(agrupados[año]).forEach(mes => {
            const liMes = document.createElement('li');
            const ulFechas = document.createElement('ul');
            liMes.textContent = `Mes: ${mes}`;
            liMes.classList.add('mes');
            
            Object.keys(agrupados[año][mes]).forEach(fecha => {
                const liFecha = document.createElement('li');
                const ulTurnos = document.createElement('ul');
                liFecha.textContent = `Fecha: ${fecha}`;
                liFecha.classList.add('fecha');
                
                agrupados[año][mes][fecha].forEach(registro => {
                const liTurno = document.createElement('li');
                liTurno.textContent = `Turno: ${registro.turno} - ${registro.molde_1}`;
                liTurno.classList.add('turno');
                
                // Botones de acciones
                const btnEditar = document.createElement('button');
                btnEditar.textContent = 'Editar';
                btnEditar.onclick = () => editarRegistro(registro.id);
                
                const btnEliminar = document.createElement('button');
                btnEliminar.textContent = 'Eliminar';
                btnEliminar.onclick = () => eliminarRegistro(registro.id);
                
                liTurno.appendChild(btnEditar);
                liTurno.appendChild(btnEliminar);
                ulTurnos.appendChild(liTurno);
                });
                
                liFecha.appendChild(ulTurnos);
                ulFechas.appendChild(liFecha);
            });
            
            liMes.appendChild(ulFechas);
            ulMeses.appendChild(liMes);
            });
            
            liAño.appendChild(ulMeses);
            arbol.appendChild(liAño);
        });
        }
        document.addEventListener("click", function(event) {
        // Verifica si el clic fue en un año, mes, fecha o turno
        if (event.target.classList.contains('año') || 
            event.target.classList.contains('mes') || 
            event.target.classList.contains('fecha') || 
            event.target.classList.contains('turno')) {
            event.target.classList.toggle('active');
        }
        });
        function formatearFecha(fecha) {
        const partes = fecha.split('-'); // Suponiendo que la fecha venga en formato yyyy-mm-dd
        const año = partes[0];
        const mes = partes[1];
        const dia = partes[2];
        
        return `${dia}/${mes}/${año}`; // Retornar en formato dd/mm/yyyy
        }
        
      
  </body>
</html>

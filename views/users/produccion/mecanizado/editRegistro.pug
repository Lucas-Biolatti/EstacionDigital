<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Polimetal SA - Inyeccion</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/dashboard/">
    <link href="//cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link href="/assets/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/stylesheets/dashboard.css" rel="stylesheet">
    

  </head>
  <body>
    
    <header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
      <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="#">POLIMETAL S.A</a>
      <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      
      <div class="navbar-nav">
        <div class="nav-item text-nowrap">
          <a class="nav-link px-3" href="#">Sign out</a>
        </div>
      </div>
    </header>

    <div class="container-fluid">
      <div class="row">
        <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
          <div class="position-sticky pt-3">
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="/users/produccion">
                  <span data-feather="home"></span>
                    | Inicio
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" href="#">
                  <span data-feather="file"></span>
                   |Registros de Produccion
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="bar-chart-2"></span>
                   |Registro de paradas
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="users"></span>
                   |Customers
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="bar-chart-2"></span>
                   |Reports
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="layers"></span>
                   |Integrations
                </a>
              </li>
            </ul>

            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
              <span>Saved reports</span>
              <a class="link-secondary" href="#" aria-label="Add a new report">
                <span data-feather="plus-circle"></span>
              </a>
            </h6>
            <ul class="nav flex-column mb-2">
              <li class="nav-item">
                <a class="nav-link" href="moldes">
                  <span data-feather="file-text"></span>
                   |Moldes entre fechas
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="modelos">
                  <span data-feather="file-text"></span>
                   |Modelos entre fechas
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="tornillos">
                  <span data-feather="file-text"></span>
                   |Tornillos
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="produccionDia">
                  <span data-feather="file-text"></span>
                   |Produccion del Dia
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="tecnicos">
                  <span data-feather="file-text"></span>
                   |Seguimiento de Tecnicos
                </a>
              </li>
            </ul>
          </div>
        </nav>

        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
         
          h4 Actualizar Registro
          hr
          <div class="container mt-4">
            h2(class="text-center mb-4")="Regitro N°"+result[0].id+" - "+result[0].maquina 
            <form id="turnoForm" method="POST" action="editRegistro">
                <!-- Pestañas -->
                <ul class="nav nav-tabs" id="formTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="tab1" data-bs-toggle="tab" data-bs-target="#page1" type="button" role="tab">Información General</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tab2" data-bs-toggle="tab" data-bs-target="#page2" type="button" role="tab">Control 1</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tab3" data-bs-toggle="tab" data-bs-target="#page3" type="button" role="tab">Control 2</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tab4" data-bs-toggle="tab" data-bs-target="#page4" type="button" role="tab">Control 3</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tab5" data-bs-toggle="tab" data-bs-target="#page5" type="button" role="tab">Control 4</button>
                    </li>
                </ul>

                <!-- Contenido de las Pestañas -->
                <div class="tab-content mt-3" id="formTabsContent">
                    <!-- Página 1: Información General -->
                    <div class="tab-pane fade show active" id="page1" role="tabpanel" aria-labelledby="tab1">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="fecha" class="form-label">Fecha</label>
                                input(type="date" class="form-control" id="fecha" name="fecha" required value=fecha)
                            </div>
                            <div class="col-md-6">
                                <label for="turno" class="form-label">Turno</label>
                                <select class="form-select" id="turno" name="turno" required>
                                    option(value=result[0].turno)=result[0].turno
                                    <option value="MAÑANA">Mañana</option>
                                    <option value="TARDE">Tarde</option>
                                    <option value="NOCHE">Noche</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="supervisor" class="form-label">Supervisor</label>
                                input(type="text" name="supervisor" class="form-control" value=nombre required)
                            </div>
                            <div class="col-md-6">
                                <label for="maquina" class="form-label">Seleccionar Máquinas</label>
                                <select id="maquina" name="maquina" class="form-select">
                                    option(value=result[0].maquina)=result[0].maquina
                                    <option value="Isla 1">Isla 1</option>
                                    <option value="Isla 3">Isla 3</option>
                                    <option value="Isla 6">Isla 6</option>
                                    <option value="Isla 7">Isla 7</option>
                                    <option value="Isla 8">Isla 8</option>
                                    <option value="Isla 9">Isla 9</option>
                                    <option value="Isla 10">Isla 10</option>
                                    <option value="Isla 11">Isla 11</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="operador" class="form-label">Operador</label>
                                input(type="text" name="operador" class="form-control" required value=result[0].operador)
                            </div>
                            <div class="col-md-6">
                                <label for="operador" class="form-label">Observaciones</label>
                                textarea(name="observaciones" class="form-control") 

                            </div>
                            
                        </div>
                    </div>

                    <!-- Página 2: Control 1 -->
                    <div class="tab-pane fade" id="page2" role="tabpanel" aria-labelledby="tab2">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="modelo" class="form-label">Seleccionar Modelo</label>
                                <select id="modelo" name="modelo" class="form-select" required>
                                    option(value=result[0].modelo1)=value=result[0].modelo1
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="kit" class="form-label">Seleccionar Kit</label>
                                <select id="kit" name="kit" class="form-select" required>
                                    option(value=result[0].kit1)=result[0].kit1
                                    <option value="">-</option>
                                    <option value="K1">K1</option>
                                    <option value="K2">K2</option>
                                    <option value="K3">K3</option>
                                    <option value="K4">K4</option>
                                    <option value="K5">K5</option>
                                    <option value="K6">K6</option>
                                    <option value="K7">K7</option>
                                    <option value="K8">K8</option>
                                    <option value="K9">K9</option>
                                    <option value="K10">K10</option>
                                    <option value="K11">K11</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="tiempo_prog" class="form-label">Tiempo Programado</label>
                                input(type="number" name="tiempo_prog" class="form-control" required value=result[0].tiempo_prog)
                            </div>
                            <div class="col-md-4">
                                <label for="programadas" class="form-label">Ruedas Programadas</label>
                                input(type="number" name="programadas" id="programadas" class="form-control" required value=result[0].programadas)
                            </div>
                            <div class="col-md-4">
                                <label for="aprobadas" class="form-label">Aprobadas</label>
                                input(type="number" name="aprobadas" class="form-control" value=result[0].aprobadas)
                            </div>
                            <div class="col-md-4">
                                <label for="op_int" class="form-label">Operación Intermedia</label>
                                input(type="number" name="op_int" class="form-control" value=result[0].op_int)
                            </div>
                            <div class="col-md-4">
                                <label for="scrap" class="form-label">Scrap</label>
                                input(type="number" name="scrap" class="form-control" value=result[0].scrap)
                            </div>
                        </div>
                    </div>
                    <!-- Página 3: Control 2 -->
                    <div class="tab-pane fade" id="page3" role="tabpanel" aria-labelledby="tab3">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="modelo2" class="form-label">Seleccionar Modelo</label>
                                <select id="modelo2" name="modelo2" class="form-select" required>
                                    <option value="">-</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="kit2" class="form-label">Seleccionar Kit</label>
                                <select id="kit2" name="kit2" class="form-select" required>
                                    <option value="">-</option>
                                    <option value="K1">K1</option>
                                    <option value="K2">K2</option>
                                    <option value="K3">K3</option>
                                    <option value="K4">K4</option>
                                    <option value="K5">K5</option>
                                    <option value="K6">K6</option>
                                    <option value="K7">K7</option>
                                    <option value="K8">K8</option>
                                    <option value="K9">K9</option>
                                    <option value="K10">K10</option>
                                    <option value="K11">K11</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="tiempo_prog2" class="form-label">Tiempo Programado</label>
                                <input type="number" name="tiempo_prog2" class="form-control" required value="120">
                            </div>
                            <div class="col-md-4">
                                <label for="programadas2" class="form-label">Ruedas Programadas</label>
                                <input type="number" name="programadas2" id="programadas2" class="form-control" required>
                            </div>
                            <div class="col-md-4">
                                <label for="aprobadas2" class="form-label">Aprobadas</label>
                                <input type="number" name="aprobadas2" class="form-control" value="0">
                            </div>
                            <div class="col-md-4">
                                <label for="op_int2" class="form-label">Operación Intermedia</label>
                                <input type="number" name="op_int2" class="form-control" value="0">
                            </div>
                            <div class="col-md-4">
                                <label for="scrap2" class="form-label">Scrap</label>
                                <input type="number" name="scrap2" class="form-control" value="0">
                            </div>
                        </div>
                    </div>
                     <!-- Página 4: Control 3 -->
                    <div class="tab-pane fade" id="page4" role="tabpanel" aria-labelledby="tab4">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="modelo3" class="form-label">Seleccionar Modelo</label>
                                <select id="modelo3" name="modelo3" class="form-select" required>
                                    <option value="">-</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="kit3" class="form-label">Seleccionar Kit</label>
                                <select id="kit3" name="kit3" class="form-select" required>
                                    <option value="">-</option>
                                    <option value="K1">K1</option>
                                    <option value="K2">K2</option>
                                    <option value="K3">K3</option>
                                    <option value="K4">K4</option>
                                    <option value="K5">K5</option>
                                    <option value="K6">K6</option>
                                    <option value="K7">K7</option>
                                    <option value="K8">K8</option>
                                    <option value="K9">K9</option>
                                    <option value="K10">K10</option>
                                    <option value="K11">K11</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="tiempo_prog3" class="form-label">Tiempo Programado</label>
                                <input type="number" name="tiempo_prog3" class="form-control" required value="120">
                            </div>
                            <div class="col-md-4">
                                <label for="programadas3" class="form-label">Ruedas Programadas</label>
                                <input type="number" name="programadas3" id="programadas3" class="form-control" required>
                            </div>
                            <div class="col-md-4">
                                <label for="aprobadas3" class="form-label">Aprobadas</label>
                                <input type="number" name="aprobadas3" class="form-control" value="0">
                            </div>
                            <div class="col-md-4">
                                <label for="op_int3" class="form-label">Operación Intermedia</label>
                                <input type="number" name="op_int3" class="form-control" value="0">
                            </div>
                            <div class="col-md-4">
                                <label for="scrap3" class="form-label">Scrap</label>
                                <input type="number" name="scrap3" class="form-control" value="0">
                            </div>
                        </div>
                    </div>
                     <!-- Página 5: Control 4 -->
                    <div class="tab-pane fade" id="page5" role="tabpanel" aria-labelledby="tab5">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="modelo4" class="form-label">Seleccionar Modelo</label>
                                <select id="modelo4" name="modelo4" class="form-select" required>
                                    <option value="">-</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="kit4" class="form-label">Seleccionar Kit</label>
                                <select id="kit4" name="kit4" class="form-select" required>
                                    <option value="">-</option>
                                    <option value="K1">K1</option>
                                    <option value="K2">K2</option>
                                    <option value="K3">K3</option>
                                    <option value="K4">K4</option>
                                    <option value="K5">K5</option>
                                    <option value="K6">K6</option>
                                    <option value="K7">K7</option>
                                    <option value="K8">K8</option>
                                    <option value="K9">K9</option>
                                    <option value="K10">K10</option>
                                    <option value="K11">K11</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="tiempo_prog4" class="form-label">Tiempo Programado</label>
                                <input type="number" name="tiempo_prog4" class="form-control" required value="120">
                            </div>
                            <div class="col-md-4">
                                <label for="programadas4" class="form-label">Ruedas Programadas</label>
                                <input type="number" name="programadas4" id="programadas4" class="form-control" required>
                            </div>
                            <div class="col-md-4">
                                <label for="aprobadas4" class="form-label">Aprobadas</label>
                                <input type="number" name="aprobadas4" class="form-control" value="0">
                            </div>
                            <div class="col-md-4">
                                <label for="op_int4" class="form-label">Operación Intermedia</label>
                                <input type="number" name="op_int4" class="form-control" value="0">
                            </div>
                            <div class="col-md-4">
                                <label for="scrap4" class="form-label">Scrap</label>
                                <input type="number" name="scrap4" class="form-control" value="0">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-primary">Actualizar Registro</button>
                </div>
                 
                    
                </div>

                
            </form>
        </div>
         
        </main>
      </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js" ></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.2.0/chartjs-plugin-datalabels.min.js" integrity="sha512-JPcRR8yFa8mmCsfrw4TNte1ZvF1e3+1SdGMslZvmrzDYxS69J7J49vkFL8u6u8PlPJK+H3voElBtUCzaXj+6ig==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <script src="/assets/dist/js/bootstrap.bundle.min.js"></script>
    
    
    script.
      feather.replace({ 'aria-hidden': 'true' });
  
      
     document.addEventListener('DOMContentLoaded', () => {
            // Obtener referencias a los elementos
            const programadasInput = document.getElementById('programadas');
            const programadas2Input = document.getElementById('programadas2');
            const programadas3Input = document.getElementById('programadas3');
            const programadas4Input = document.getElementById('programadas4');
            const prog = document.getElementById('maquina');

            // Mapeo de valores
            const valores = {
                'isla 1': 28,
                'isla 3': 42,
                'isla 6': 42,
                'isla 7': 30,
                'isla 8': 42,
                'isla 9': 42,
                'isla 10': 30,
                'isla 11': 42,
            };

            // Función para actualizar los valores
            const actualizarValores = (valorSeleccionado) => {
                const valor = valores[valorSeleccionado] || '';
                programadasInput.value = valor;
                programadas2Input.value = valor;
                programadas3Input.value = valor;
                programadas4Input.value = valor;
            };

            // Inicializar valores al cargar la página
            actualizarValores(prog.value);

            // Detectar cambios en el selector de máquina
            prog.addEventListener('change', (e) => {
                actualizarValores(e.target.value);
            });
        });
      //Carga de modelos
      fetch('/users/modelos')
      .then(response => response.json())
      .then(datos => {
            const selectModelo = document.getElementById('modelo'); // Referencia al select con id "modelo"
            const selectModelo2 = document.getElementById('modelo2');
            const selectModelo3 = document.getElementById('modelo3');
            const selectModelo4 = document.getElementById('modelo4');
          
          // Limpiar el select antes de llenarlo (opcional si no tiene contenido inicial)
          

          // Iterar sobre los datos y agregar opciones al select
          datos.forEach(dato => {
            if (dato.modelo) {
                const option1 = document.createElement('option');
                option1.value = dato.modelo;
                option1.textContent = dato.modelo;

                const option2 = document.createElement('option');
                option2.value = dato.modelo;
                option2.textContent = dato.modelo;

                const option3 = document.createElement('option');
                option3.value = dato.modelo;
                option3.textContent = dato.modelo;

                const option4 = document.createElement('option');
                option4.value = dato.modelo;
                option4.textContent = dato.modelo;

                selectModelo.appendChild(option1);
                selectModelo2.appendChild(option2);
                selectModelo3.appendChild(option3);
                selectModelo4.appendChild(option4);
            }
        });
      })
      .catch(error => console.error('Error al obtener los modelos:', error));
      //Carga de molde1
      const modeloSelect = document.getElementById('modelo');
      const kitSelect = document.getElementById('kit');
      const moldeInput = document.getElementById('molde');

      // Función para actualizar el valor del input "molde"
      function actualizarMolde() {
          const modelo = modeloSelect.value;
          const kit = kitSelect.value;
          moldeInput.value = `${modelo} ${kit}`; // Concatenar los valores
      }

      // Escuchar el evento "change" en ambos selects
      modeloSelect.addEventListener('change', actualizarMolde);
      kitSelect.addEventListener('change', actualizarMolde);

      //Carga de molde2
      const modelo2Select = document.getElementById('modelo2');
      const kit2Select = document.getElementById('kit2');
      const molde2Input = document.getElementById('molde2');

      // Función para actualizar el valor del input "molde"
      function actualizarMolde2() {
          const modelo2 = modelo2Select.value;
          const kit2 = kit2Select.value;
          molde2Input.value = `${modelo2} ${kit2}`; // Concatenar los valores
      }

      // Escuchar el evento "change" en ambos selects
      modelo2Select.addEventListener('change', actualizarMolde2);
      kit2Select.addEventListener('change', actualizarMolde2);

      //Carga de molde3
      const modelo3Select = document.getElementById('modelo3');
      const kit3Select = document.getElementById('kit3');
      const molde3Input = document.getElementById('molde3');

      // Función para actualizar el valor del input "molde"
      function actualizarMolde3() {
          const modelo3 = modelo3Select.value;
          const kit3 = kit3Select.value;
          molde3Input.value = `${modelo3} ${kit3}`; // Concatenar los valores
      }

      // Escuchar el evento "change" en ambos selects
      modelo3Select.addEventListener('change', actualizarMolde3);
      kit3Select.addEventListener('change', actualizarMolde3);

        //Carga de molde4
      const modelo4Select = document.getElementById('modelo4');
      const kit4Select = document.getElementById('kit4');
      const molde4Input = document.getElementById('molde4');

      // Función para actualizar el valor del input "molde"
      function actualizarMolde4() {
          const modelo4 = modelo4Select.value;
          const kit4 = kit4Select.value;
          molde4Input.value = `${modelo4} ${kit4}`; // Concatenar los valores
      }

      // Escuchar el evento "change" en ambos selects
      modelo4Select.addEventListener('change', actualizarMolde4);
      kit4Select.addEventListener('change', actualizarMolde4);


      let cons = document.getElementById('consultar')
      cons.addEventListener('click',(e)=>{
        
        e.preventDefault();
        let fecha = document.getElementById('fini').value;
        fetch(`reg_prod_fecha?fecha=${fecha}`)
          .then(response => response.json())
          .then(datos =>{
            console.log(datos)
            //Maquinas
            let mañana = 0;
            let tarde = 0;
            let noche = 0;
            //Golpes
            let gm = 0;
            let gt = 0;
            let gn = 0;
            //Ruedas ok
            let om = 0;
            let ot = 0;
            let on = 0;
            //Tablas
            let t1 = document.getElementById('table1');
            let t2 = document.getElementById('table2');
            let t3 = document.getElementById('table3');
            let t4 = document.getElementById('table4');
            let t5 = document.getElementById('table5');
            //Vaciar Tablas
            t1.innerHTML = "";
            t2.innerHTML = "";
            t3.innerHTML = "";
            t4.innerHTML = "";
            t5.innerHTML = "";

            datos.forEach(dato => {
              feather.replace({ 'aria-hidden': 'true' });
              if (dato.turno === 'MAÑANA') {
                mañana++;
                gm+=Number(dato.ap);
                
                
                  t1.innerHTML+=`
                <tr>
                  <td>${dato.id}</td>
                  <td>${dato.maquina}</td>
                  <td>${dato.molde}</td>
                  <td>${dato.molde2}</td>
                  <td>${dato.molde3}</td>
                  <td>${dato.molde4}</td>
                  <td>${dato.ap}</td>
                  <td>${dato.intermedia}</td>
                  <td>${dato.scrap}</td>
                  <td>${dato.tp}</td>
                  <td>${dato.prog}</td>
                  <td>${dato.observaciones}</td>
                  <td>                  
                  <a href="editrp21?id=${dato.id}&maquina=${dato.maquina}" class="btn btn-sm btn-primary">
                      <i data-feather="edit"></i>
                  </a>

                  <a href="eliminarDato?id=${dato.id}" class="btn btn-sm btn-danger">
                      <i data-feather="trash-2"></i>
                  </a>
                  </td>
                </tr>
                `
                
                
                
              } else if (dato.turno === 'TARDE') {
                tarde++;
                gt+=Number(dato.golpes);
                ot+=Number(dato.ok);
                if(dato.ok>68){
                  t2.innerHTML+=`
                <tr>
                  <td>${dato.id}</td>
                  <td>${dato.gima}</td>
                  <td>${dato.Control_1}</td>
                  <td>${dato.Control_2}</td>
                  <td>${dato.Control_3}</td>
                  <td>${dato.Control_4}</td>
                  <td>${dato.golpes}</td>
                  <td class="text-success"><strong>${dato.ok}</strong></td>
                  <td>${dato.isla}</td>
                  <td>${dato.rx}</td>
                  <td>${dato.scrap}</td>
                  <td>${dato.obs}</td>
                </tr>
                `
                }else{
                  t2.innerHTML+=`
                <tr>
                  <td>${dato.id}</td>
                  <td>${dato.gima}</td>
                  <td>${dato.Control_1}</td>
                  <td>${dato.Control_2}</td>
                  <td>${dato.Control_3}</td>
                  <td>${dato.Control_4}</td>
                  <td>${dato.golpes}</td>
                  <td class="text-danger"><strong>${dato.ok}</strong></td>
                  <td>${dato.isla}</td>
                  <td>${dato.rx}</td>
                  <td>${dato.scrap}</td>
                  <td>${dato.obs}</td>
                </tr>
                `
                }
              } else if (dato.turno === 'NOCHE') {
                noche++;
                gn+=Number(dato.golpes);
                on+=Number(dato.ok);
                if(dato.ok>68){
                  t3.innerHTML+=`
                <tr>
                  <td>${dato.id}</td>
                  <td>${dato.gima}</td>
                  <td>${dato.Control_1}</td>
                  <td>${dato.Control_2}</td>
                  <td>${dato.Control_3}</td>
                  <td>${dato.Control_4}</td>
                  <td>${dato.golpes}</td>
                  <td class="text-success"><strong>${dato.ok}</strong></td>
                  <td>${dato.isla}</td>
                  <td>${dato.rx}</td>
                  <td>${dato.scrap}</td>
                  <td>${dato.obs}</td>
                </tr>
                `
                }else{
                  t3.innerHTML+=`
                <tr>
                  <td>${dato.id}</td>
                  <td>${dato.gima}</td>
                  <td>${dato.Control_1}</td>
                  <td>${dato.Control_2}</td>
                  <td>${dato.Control_3}</td>
                  <td>${dato.Control_4}</td>
                  <td>${dato.golpes}</td>
                  <td class="text-danger"><strong>${dato.ok}</strong></td>
                  <td>${dato.isla}</td>
                  <td>${dato.rx}</td>
                  <td>${dato.scrap}</td>
                  <td>${dato.obs}</td>
                </tr>
                `
                }
              }
            });
            //Maquinas
            let m = document.getElementById('m')
            let t = document.getElementById('t')
            let n = document.getElementById('n')
            m.innerHTML = `Maquinas: <strong>${mañana}</strong>`;
            t.innerHTML = `Maquinas: <strong>${tarde}</strong>`;
            n.innerHTML = `Maquinas: <strong>${noche}</strong>`;
            //Golpes
            document.getElementById('gm').innerHTML = `Total Golpes:${mañana*75} | <strong>${gm}</strong>`;
            document.getElementById('gt').innerHTML = `Total Golpes:${tarde*75} | <strong>${gt}</strong>`;
            document.getElementById('gn').innerHTML = `Total Golpes:${noche*75} | <strong>${gn}</strong>`
            //OK
            document.getElementById('om').innerHTML = `Total OK:${mañana*68} | <strong>${om}</strong>`;
            document.getElementById('ot').innerHTML = `Total OK:${mañana*68} | <strong>${ot}</strong>`;
            document.getElementById('on').innerHTML = `Total OK:${mañana*68} | <strong>${on}</strong>`;
            //Scrap
            document.getElementById('sm').innerHTML = `Scrap: 4,5% | <strong>${((1-(om/gm))*100).toFixed(2)}%</strong>`;
            document.getElementById('st').innerHTML = `Scrap: 4,5% | <strong>${((1-(ot/gt))*100).toFixed(2)}%</strong>`;
            document.getElementById('sn').innerHTML = `Scrap: 4,5% | <strong>${((1-(on/gn))*100).toFixed(2)}%</strong>`;

            
           // Paso 1: Calcular la suma total de todos los golpes en el arreglo completo
            const sumaTotalGolpes = datos.reduce((acc, item) => acc + item.golpes, 0);

            // Paso 2: Agrupar por 'gima' y calcular 'scrap' y 'ponderado'
            const agrupadoPorGima = datos.reduce((acc, item) => {
              const { gima, golpes, rx, isla, ok } = item;

              if (!acc[gima]) {
                acc[gima] = {
                  gima,
                  golpes: 0,
                  rx: 0,
                  isla: 0,
                  ok: 0,
                  scrap: 0
                };
              }

              // Sumar valores
              acc[gima].golpes += golpes;
              acc[gima].rx += rx;
              acc[gima].isla += isla;
              acc[gima].ok += ok;
              acc[gima].scrap = ((acc[gima].rx + acc[gima].isla) / acc[gima].golpes) * 100;

              return acc;
            }, {});

            // Paso 3: Convertir a un arreglo y calcular 'ponderado'
            const resultado = Object.values(agrupadoPorGima).map(item => {
              const { gima, golpes, rx, isla,ok, scrap } = item;
              // Ponderado calculado con la suma total de golpes de todas las filas
              const ponderado = ((rx + isla) / sumaTotalGolpes) * 100;

              return {
                gima,
                golpes,
                rx,
                isla,
                ok,
                scrap: `${scrap.toFixed(2)}%`,
                ponderado // Mantener ponderado como número para el ordenamiento
              };
            });

            // Paso 4: Ordenar por 'ponderado' de mayor a menor
            const resultadoOrdenado = resultado.sort((a, b) => b.ponderado - a.ponderado);

            // Paso 5: Formatear 'ponderado' a cadena con '%'
            const resultadoFinal = resultadoOrdenado.map(item => ({
              ...item,
              ponderado: `${item.ponderado.toFixed(2)}%` // Convertir ponderado a cadena con '%'
            }));


            
            // Armado de tabla
            resultadoFinal.forEach(e =>{
              t4.innerHTML += `
              <tr>
                  <td>${e.gima}</td>
                  <td>${e.golpes}</td>
                  <td>${e.isla}</td>
                  <td>${e.rx}</td>
                  <td>${e.ok}</td>
                  <td>${e.scrap}</td>
                  <td>${e.ponderado}</td>
                  
                </tr>
              `
            } )
            // Paso 2: Tomar las 3 primeras gimas
            const top3Gimas = resultadoOrdenado.slice(0, 3).map(item => item.gima);

            // Paso 3: Obtener las observaciones separadas por turno y ordenadas por ponderado
            const observacionesPorTurno = top3Gimas.map(gima => {
              // Filtrar las observaciones correspondientes a la gima y agruparlas por turno
              const observaciones = datos
                .filter(item => item.gima === gima)
                .reduce((acc, item) => {
                  const { turno, obs } = item;

                  // Si no existe el turno, inicializar el arreglo
                  if (!acc[turno]) {
                    acc[turno] = [];
                  }

                  // Agregar la observación
                  acc[turno].push(obs);

                  return acc;
                }, {});

              return {
                gima,
                turnos: observaciones
              };
            });
            observacionesPorTurno.forEach(e =>{
              t5.innerHTML += `
              <tr>
                  <td>${e.gima}</td>
                  <td>${e.turnos.MAÑANA}</td>
                  <td>${e.turnos.TARDE}</td>
                  <td>${e.turnos.NOCHE}</td>
                  
                  
                </tr>
              `
            })
            

          })
      })
      

   


  
    

  </body>
</html>
